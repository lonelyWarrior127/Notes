# 内部类

![img](http://c.biancheng.net/uploads/allimg/181023/3-1Q02311045J93.jpg)

**内部类的特点如下：**

1. 内部类仍然是一个独立的类，在编译之后内部类会被编译成独立的`.class`文件，但是前面冠以外部类的类名和`$`符号。
2. 内部类不能用普通的方式访问。内部类是外部类的一个成员，因此内部类可以自由地访问外部类的成员变量，无论是否为 private 的。
3. 内部类声明成静态的，就不能随便访问外部类的成员变量，仍然是只能访问外部类的静态成员变量。

**有关内部类的说明有如下几点：**

- 外部类只有两种访问级别：public 和默认；内部类则有 4 种访问级别：public、protected、 private 和默认。
- 在外部类中可以直接通过内部类的类名访问内部类。

```java
InnerClass ic = new InnerClass();    // InnerClass为内部类的类名
```

- 在外部类以外的其他类中则需要通过内部类的完整类名访问内部类。

```java
Test.InnerClass ti = newTest().new InnerClass();    // Test.innerClass是内部类的完整类名
```

- 内部类与外部类不能重名。

## 实例内部类 & 静态内部类

|      | 实例内部类                                                   | 静态内部类                                                   |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 创建 | 1. 外部类的静态方法和外部类以外的其他类中，必须通过外部类的实例创建内部类的实例 `Outer.Inner i = new Outer().new Inner();`<br>2. `Inner1 i = new Inner1();` | 1. 不需要外部类的实例  `Outer.Inner oi = new Outer.Inner();`<br>2. 静态内部类中可以定义静态成员和实例成员。 |
| 访问 | 1. 实例内部类 → 外部类成员 ： 直接 ；<br>2.外部类→内部类：内部类的实例 | 1.  外部类以外的类 → 内部类的静态变量： `int b2 = Outer.Inner.b;// 访问静态成员`<br/>2. 外部类以外的类 → 内部类的实例成员:静态内部类的实例 `int a2 = oi.a;    // 访问实例成员`<br/>3. 静态内部类 →外部类的静态成员：直接访问<br>4. 静态内部类 →外部类的实例成员：通过外部类的实例 |

## 局部内部类

指在一个方法中定义的内部类。

```java
public class Test {
    Inner i = new Inner();    // 编译出错
    Test.Inner ti = new Test.Inner();    // 编译出错
    Test.Inner ti2 = new Test().new Inner();    // 编译出错
    public void method() {
        class Inner{
            //局部内部类     
        }
        Inner i = new Inner();
    }
}
```

- 局部内部类与局部变量一样，不能使用访问控制修饰符（public、private 和 protected）和 static 修饰符修饰
- 局部内部类只在当前方法中有效
- 局部内部类中不能定义 static 成员
- 局部内部类中还可以包含内部类，但是这些内部类也不能使用访问控制修饰符（public、private 和 protected）和 static 修饰符修饰
- 在局部内部类中可以访问外部类的所有成员
- 在局部内部类中只可以访问当前方法中 final 类型的参数与变量。如果方法中的成员与外部类中的成员同名，则可以使用 <OuterClassName>.this.<MemberName> 的形式访问外部类中的成员

```java
public class Test {
    int a = 0;
    int d = 0;
    public void method() {
        int b = 0;
        final int c = 0;
        final int d = 10;
        class Inner {
            int a2 = a;    // 访问外部类中的成员
            // int b2 = b;    // 编译出错,只可以访问当前方法中 final 类型的参数与变量
            int c2 = c;    // 访问方法中的成员
            int d2 = d;    // 访问方法中的成员
            int d3 = Test.this.d;    //访问外部类中的成员
        }
        Inner i = new Inner();
        System.out.println(i.d2);    // 输出10
        System.out.println(i.d3);    // 输出0
    }
    public static void main(String[] args) {
        Test t = new Test();
        t.method();
    }
}
```

## 匿名类

匿名类是指没有类名的内部类，必须在创建时使用 new 语句来声明类。其语法形式如下：

```java
new <类或接口>() {
    // 类的主体
};
```

匿名类有两种实现方式：

- 继承一个类，重写其方法。
- 实现一个接口（可以是多个），实现其方法。

匿名类有如下特点：

- 匿名类和局部内部类一样，可以访问外部类的所有成员。如果匿名类位于一个方法中，则匿名类只能访问方法中 final 类型的局部变量和参数
- 匿名类中允许使用非静态代码块进行成员初始化操作
- 匿名类的非静态代码块会在父类的构造方法之后被执行

```java
public static void main(String[] args) {
    int a = 10;
    final int b = 10;
    Out anonyInter = new Out() {
        void show() {
            // System.out.println("调用了匿名类的 show() 方法"+a);    // 编译出错
            System.out.println("调用了匿名类的 show() 方法"+b);    // 编译通过
        }
    };
    anonyInter.show();
}
```

